<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FMS: diag_table_mod</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FMS
   </div>
   <div id="projectbrief">Flexible Modeling System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__diag__table__mod.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">diag_table_mod</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>diag_table_mod</code> is a set of subroutines use to parse out the data from a <code>diag_table</code>. This module will also setup the arrays required to store the information by counting the number of input fields, output files, and files.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:gadadc44257b97056c277261b4ada5098b"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__diag__table__mod.html#gadadc44257b97056c277261b4ada5098b">parse_diag_table</a> (diag_subset, istat, err_msg)</td></tr>
<tr class="memdesc:gadadc44257b97056c277261b4ada5098b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the <code>diag_table</code> in preparation for diagnostic output.  <a href="group__diag__table__mod.html#gadadc44257b97056c277261b4ada5098b">More...</a><br /></td></tr>
<tr class="separator:gadadc44257b97056c277261b4ada5098b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p><code>diag_table_mod</code> is a set of subroutines use to parse out the data from a <code>diag_table</code>. This module will also setup the arrays required to store the information by counting the number of input fields, output files, and files. </p>
<dl class="section author"><dt>Author</dt><dd>Seth Underwood</dd></dl>
<p><code>diag_table_mod</code> parses the <code>diag_table</code> file, and sets up the required arrays to hold the information needed for the <code>diag_manager_mod</code> to correctly write out the model history files.</p>
<p>The <em>diagnostics table</em> allows users to specify sampling rates and the choice of fields at run time. The <code>diag_table</code> file consists of comma-separated ASCII values. The <code>diag_table</code> essentially has three sections: <b>Global</b>, <b>File</b>, and <b>Field</b> sections. The <b>Global</b> section must be the first two lines of the file, whereas the <b>File</b> and <b>Field</b> sections can be inter mixed to allow the file to be organized as desired. Comments can be added to the <code>diag_table</code> file by using the hash symbol (#) as the first character in the line.</p>
<p>All errors in the <code>diag_table</code> will throw a <code>FATAL</code> error. A simple utility <code>diag_table_chk</code>has been added to the FRE tools suite to check a <code>diag_table</code> for errors. A brief usage statement can be obtained by running <code>diag_table_chk &ndash;help</code>, and a man page like description can views by running <code>perldoc diag_table_chk</code>.</p>
<p>Below is a description of the three sections. </p><ol>
<li>
<b>Global Section:</b> The first two lines of the <code>diag_table</code> must contain the <em>title</em> and the <em>base date</em> of the experiment respectively. The <em>title</em> must be a Fortran CHARACTER string. The <em>base date</em> is the reference time used for the time units, and must be greater than or equal to the model start time. The <em>base date</em> consists of six space-separated integer in the following format.<br  />
 <code>&lt;NOBR&gt;year month day hour minute second&lt;/NOBR&gt;</code><br  />
  </li>
<li>
<b>File Section:</b> File lines contain 6 required and 5 optional fields (optional fields are surrounded with square brackets ([]). File lines can be intermixed with the field lines, but the file must be defined before any fields that are to be written to the file. File lines have the following format:<br  />
 &lt;PRELN&gt; "file_name", output_freq, "output_freq_units", file_format, "time_axis_units", "time_axis_name" [, new_file_freq, "new_file_freq_units"[, "start_time"[, file_duration, "file_duration_units"]]] &lt;/PRELN&gt; <br  />
 with the following descriptions. <dl>
<dt><code>CHARACTER(len=128) :: file_name</code> </dt>
<dd><p class="startdd">Output file name without the trailing "&lt;TT&gt;.nc&lt;/TT&gt;".</p>
<p class="enddd">A single file description can produce multiple files using special time string suffix keywords. This time string will append the time strings to the base file name each time a new file is opened. They syntax for the time string suffix keywords are <code>%#tt</code> Where <code>#</code> is a mandatory single digit number specifying the width of the field, and <code>tt</code> can be as follows: &lt;NL&gt; </p>
</dd>
</dl>
</li>
<li>
<code>yr</code> &lt;EN &gt; Years </li>
<li>
<code>mo</code> &lt;EN &gt; Months </li>
<li>
<code>dy</code> &lt;EN &gt; Days </li>
<li>
<code>hr</code> &lt;EN &gt; Hours </li>
<li>
<code>mi</code> &lt;EN &gt; Minutes </li>
<li>
<p class="startli"><code>sc</code> &lt;EN &gt; Seconds &lt;/NL&gt; Thus, a file name of <code>file2_yr_dy%1yr%3dy</code> will have a base file name of <code>file2_yr_dy_1_001</code> if the file is created on year 1 day 1 of the model run. <b><em>NOTE:</em></b> The time suffix keywords must be used if the optional fields <code>new_file_freq</code> and <code>new_file_freq_units</code> are used, otherwise a <code>FATAL</code> error will occur. </p>
<p class="endli"></p>
</li>
</ol>
<p><code>INTEGER :: output_freq</code> How often to write fields to file. &lt;NL&gt; <code>&gt; 0</code> &lt;EN &gt; Output frequency in <code>output_freq_units</code>. <code>= 0</code> &lt;EN &gt; Output frequency every time set. (<code>output_freq_units</code> is ignored.) <code>=-1</code> &lt;EN &gt; Output at end of run only. (<code>output_freq_units</code> is ignored.) &lt;/NL&gt;  </p>
<p><code>CHARACTER(len=10) :: output_freq_units</code>  Time units for output. Can be either <code>years</code>, <code>months</code>, <code>days</code>, <code>minutes</code>, <code>hours</code>, or <code>seconds</code>.  </p>
<p><code>INTEGER :: file_format</code>  Output file format. Currently only the <em>netCDF</em> file format is supported. &lt;NL&gt; <code>= 1</code> &lt;EN &gt; netCDF &lt;/NL&gt;  </p>
<p><code>CHARACTER(len=10) :: time_axis_units</code>  Time units for the output file time axis. Can be either <code>years</code>, <code>months</code>, <code>days</code>, <code>minutes</code>, <code>hours</code>, or <code>seconds</code>.  </p>
<p><code>CHARACTER(len=128) :: time_axis_name</code>  Axis name for the output file time axis. The character sting must contain the string 'time'. (mixed upper and lowercase allowed.)  </p>
<p><code>INTEGER, OPTIONAL :: new_file_freq</code>  Frequency for closing the existing file, and creating a new file in <code>new_file_freq_units</code>.  </p>
<p><code>CHARACTER(len=10), OPTIONAL :: new_file_freq_units</code>  Time units for creating a new file. Can be either <code>years</code>, <code>months</code>, <code>days</code>, <code>minutes</code>, <code>hours</code>, or <code>seconds</code>. <b><em>NOTE:</em></b> If the <code>new_file_freq</code> field is present, then this field must also be present.  </p>
<p><code>CHARACTER(len=25), OPTIONAL :: start_time</code>  Time to start the file for the first time. The format of this string is the same as the <em>global date</em>. <b><em> NOTE:</em></b> The <code>new_file_freq</code> and the <code>new_file_freq_units</code> fields must be present to use this field.  </p>
<p><code>INTEGER, OPTIONAL :: file_duration</code>  How long file should receive data after start time in <code>file_duration_units</code>. This optional field can only be used if the <code>start_time</code> field is present. If this field is absent, then the file duration will be equal to the frequency for creating new files. <b><em>NOTE:</em></b> The <code>file_duration_units</code> field must also be present if this field is present.  </p>
<p><code>CHARACTER(len=10), OPTIONAL :: file_duration_units</code>  File duration units. Can be either <code>years</code>, <code>months</code>, <code>days</code>, <code>minutes</code>, <code>hours</code>, or <code>seconds</code>. <b><em>NOTE:</em></b> If the <code>file_duration</code> field is present, then this field must also be present.  </p>
<p><b>Field Section:</b> Field lines contain 8 fields. Field lines can be intermixed with file lines. Fields line can contain fields that are not written to any files. The file name for these fields is <code>null</code>.</p>
<p>Field lines have the following format:<br  />
 </p><pre>
 "module_name", "field_name", "output_name", "file_name", "time_sampling", "reduction_method", "regional_section", packing
       </pre><p> with the following descriptions. </p><dl>
<dt><code>CHARACTER(len=128) :: module_name</code> </dt>
<dd>Module that contains the <code>field_name</code> variable. (e.g. <code>atmos_mod</code>, <code>land_mod</code>) </dd>
<dt><code>CHARACTER(len=128) :: field_name</code> </dt>
<dd>Module variable name that has data to be written to file. </dd>
<dt><code>CHARACTER(len=128) :: output_name</code> </dt>
<dd>Name of the field as written in <code>file_name</code>. </dd>
<dt><code>CHARACTER(len=128) :: file_name</code> </dt>
<dd>Name of the file where the field is to be written. <b><em>NOTE:</em></b> The file <code>file_name</code> must be defined first.  </dd>
<dt><code>CHARACTER(len=50) :: time_sampling</code> </dt>
<dd>Currently not used. Please use the string "all". </dd>
<dt><code>CHARACTER(len=50) :: reduction_method</code> </dt>
<dd>The data reduction method to perform prior to writing data to disk. Valid options are (redundant names are separated with commas): <dl>
<dt><code>.TRUE.</code>, average, avg, mean </dt>
<dd>Average from the last time written to the current time. </dd>
<dt><code>.FALSE.</code>, none </dt>
<dd>No reduction performed. Write current time step value only. </dd>
<dt>rms </dt>
<dd>Calculate the root mean square from the last time written to the current time. </dd>
<dt>pow## </dt>
<dd>Calculate the mean of the power ## from the last time written to the current time. </dd>
<dt>min </dt>
<dd>Minimum value from last write to current time. </dd>
<dt>max </dt>
<dd>Maximum value from last write to current time. </dd>
<dt>diurnal## </dt>
<dd>## diurnal averages </dd>
</dl>
</dd>
<dt><code>CHARACTER(len=50) :: regional_section</code> </dt>
<dd>Bounds of the regional section to capture. A value of <code>none</code> indicates a global region. The regional section has the following format:<br  />
 <code>lat_min, lat_max, lon_min, lon_max, vert_min, vert_max</code><br  />
 Use <code>vert_min = -1</code> and <code>vert_max = -1</code> to get the entire vertical axis. <b><em>NOTE:</em></b> Currently, the defined region <em>MUST</em> be confined to a single tile.  </dd>
<dt><code>INTEGER :: packing</code> </dt>
<dd>Fortran number <code>KIND</code> of the data written. Valid values: &lt;NL&gt; <code>= 1</code> &lt;EN &gt; double precision <code>= 2</code> &lt;EN &gt; float <code>= 4</code> &lt;EN &gt; packed 16-bit integers <code>= 8</code> &lt;EN &gt; packed 1-byte (not tested). &lt;/NL&gt;  </dd>
</dl>
<h4><b>Sample <code>diag_table</code></b></h4>
<p>&lt;NL&gt;  </p><pre>
 "diag manager test"
 1999 1 1 0 0 0

 #output files
 10_days,               10, "days", 1, "hours", "Time"
 "file1_hr%hr3",         5, "days", 1, "hours", "Time", 15, "days"
 "file2_yr_dy%yr1%dy3",  5, "days", 1, "hours", "Time", 10, "days", "1 1 7 0 0 0"
 "file3_yr_dy%yr1%dy3",  5, "days", 1, "hours", "Time", 20, "days", "1 1 7 0 0 0", 5, "years"

 #output variables
 "ice_mod", "ice", "ice", "10_days", "all", .false., "none", 2

 # temp_local file and fields.
 temp_local, 1, "days", 1, "hours", "Time"
 "ocean_mod", "temp", "temp", "temp_local", "all", .FALSE., "5 259.5 -59.5 59.5 1 1", 2
       </pre><p>  &lt;/NL&gt;</p>
<h4>Useful Additional Utility</h4>
<p>A simple utility has been created to help discover </p>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="gadadc44257b97056c277261b4ada5098b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadadc44257b97056c277261b4ada5098b">&#9670;&nbsp;</a></span>parse_diag_table()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public diag_table_mod::parse_diag_table </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>diag_subset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out), optional, target&#160;</td>
          <td class="paramname"><em>istat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=*), intent(out), optional&#160;</td>
          <td class="paramname"><em>err_msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse the <code>diag_table</code> in preparation for diagnostic output. </p>
<p><code>parse_diag_table</code> is the public interface to parse the diag_table, and setup the arrays needed to store the requested diagnostics from the <code>diag_table</code>. <code>parse_diag_table</code> will return a non-zero <code>istat</code> if a problem parsing the <code>diag_table</code>.</p>
<p>NOT YET IMPLEMENTED: <code>parse_diag_table</code> will parse through the <code>diag_table</code> twice. The first pass, will be to get a good "guess" of array sizes. These arrays, that will hold the requested diagnostic fields and files, will then be allocated to the size of the "guess" plus a slight increase. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">diag_subset</td><td>Diagnostic sampling subset. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">istat</td><td>Status of parsing the <code>diag_table</code>. A non-zero status indicates a problem parsing the table. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">err_msg</td><td>Error message corresponding to the <code>istat</code> return value. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="diag__table_8F90_source.html#l00503">503</a> of file <a class="el" href="diag__table_8F90_source.html">diag_table.F90</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
