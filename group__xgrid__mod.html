<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FMS: xgrid_mod</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FMS
   </div>
   <div id="projectbrief">Flexible Modeling System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__xgrid__mod.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">xgrid_mod<div class="ingroups"><a class="el" href="group__exchange.html">Exchange</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>xgrid_mod</code> implements exchange grids for coupled models running on multiple processors. An exchange grid is formed from the union of the bounding lines of the two (logically rectangular) participating grids. The exchange grid is therefore the coarsest grid that is a refinement of both participating grids. Exchange grids are used for two purposes by coupled models: (1) conservative interpolation of fields between models uses the exchange grid cell areas as weights and (2) the surface flux calculation takes place on the exchange grid thereby using the finest scale data available. <code>xgrid_mod</code> uses a NetCDF grid specification file containing the grid cell overlaps in combination with the &lt;LINK SRC="ftp://ftp.gfdl.gov/pub/vb/mpp/mpp_domains.F90"&gt; <code>mpp_domains</code>&lt;/LINK&gt; domain decomposition information to determine the grid and processor connectivities.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:gaed7666b9fdf6c25272786857c6bb13ca"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgrid__mod.html#gaed7666b9fdf6c25272786857c6bb13ca">xgrid_init</a> (remap_method)</td></tr>
<tr class="memdesc:gaed7666b9fdf6c25272786857c6bb13ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the xgrid_mod.  <a href="group__xgrid__mod.html#gaed7666b9fdf6c25272786857c6bb13ca">More...</a><br /></td></tr>
<tr class="separator:gaed7666b9fdf6c25272786857c6bb13ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga37d5068bd71e797524542322ed6ad788"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgrid__mod.html#ga37d5068bd71e797524542322ed6ad788">get_ocean_model_area_elements</a> (domain, grid_file)</td></tr>
<tr class="memdesc:ga37d5068bd71e797524542322ed6ad788"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read Ocean area element data.  <a href="group__xgrid__mod.html#ga37d5068bd71e797524542322ed6ad788">More...</a><br /></td></tr>
<tr class="separator:ga37d5068bd71e797524542322ed6ad788"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab2e13403e9c0f5cab3548f86fbf55127"><td class="memItemLeft" align="right" valign="top"><a id="gab2e13403e9c0f5cab3548f86fbf55127"></a>
subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgrid__mod.html#gab2e13403e9c0f5cab3548f86fbf55127">setup_xmap</a> (xmap, grid_ids, grid_domains, grid_file, atm_grid, lnd_ug_domain)</td></tr>
<tr class="memdesc:gab2e13403e9c0f5cab3548f86fbf55127"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up exchange grid connectivity using grid specification file and processor domain decomposition. <br /></td></tr>
<tr class="separator:gab2e13403e9c0f5cab3548f86fbf55127"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3f9c9269f10dd19fa7465d5cc8b1c0f5"><td class="memItemLeft" align="right" valign="top"><a id="ga3f9c9269f10dd19fa7465d5cc8b1c0f5"></a>
subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgrid__mod.html#ga3f9c9269f10dd19fa7465d5cc8b1c0f5">set_frac_area_ug</a> (f, grid_id, xmap)</td></tr>
<tr class="memdesc:ga3f9c9269f10dd19fa7465d5cc8b1c0f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes sub-grid portion areas and/or number. <br /></td></tr>
<tr class="separator:ga3f9c9269f10dd19fa7465d5cc8b1c0f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0165e4d85c2583255e8a82c345fa4912"><td class="memItemLeft" align="right" valign="top">integer function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgrid__mod.html#ga0165e4d85c2583255e8a82c345fa4912">xgrid_count</a> (xmap)</td></tr>
<tr class="memdesc:ga0165e4d85c2583255e8a82c345fa4912"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns current size of exchange grid variables.  <a href="group__xgrid__mod.html#ga0165e4d85c2583255e8a82c345fa4912">More...</a><br /></td></tr>
<tr class="separator:ga0165e4d85c2583255e8a82c345fa4912"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0d6740065d2355a4ac54b90c8c4545fb"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgrid__mod.html#ga0d6740065d2355a4ac54b90c8c4545fb">some</a> (xmap, some_arr, grid_id)</td></tr>
<tr class="memdesc:ga0d6740065d2355a4ac54b90c8c4545fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns logical associating exchange grid cells with given side two grid.  <a href="group__xgrid__mod.html#ga0d6740065d2355a4ac54b90c8c4545fb">More...</a><br /></td></tr>
<tr class="separator:ga0d6740065d2355a4ac54b90c8c4545fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafdf2e079aab38266765c40c596790757"><td class="memItemLeft" align="right" valign="top"><a id="gafdf2e079aab38266765c40c596790757"></a>
subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__xgrid__mod.html#gafdf2e079aab38266765c40c596790757">get_xmap_grid_area</a> (id, xmap, area)</td></tr>
<tr class="memdesc:gafdf2e079aab38266765c40c596790757"><td class="mdescLeft">&#160;</td><td class="mdescRight">This routine is used to get the grid area of component model with id. <br /></td></tr>
<tr class="separator:gafdf2e079aab38266765c40c596790757"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaed04b02075e7219dcea14ec794df20c9"><td class="memItemLeft" align="right" valign="top"><a id="gaed04b02075e7219dcea14ec794df20c9"></a>
subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><b>get_index_range</b> (xmap, grid_index, is, ie, js, je, km)</td></tr>
<tr class="separator:gaed04b02075e7219dcea14ec794df20c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga4d8ce3d2176128d006c86ce02acaa0fa"><td class="memItemLeft" align="right" valign="top"><a id="ga4d8ce3d2176128d006c86ce02acaa0fa"></a>
integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><b>second_order</b> = 2</td></tr>
<tr class="separator:ga4d8ce3d2176128d006c86ce02acaa0fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1ff8193d33aacaafdf1797ff978daea1"><td class="memItemLeft" align="right" valign="top"><a id="ga1ff8193d33aacaafdf1797ff978daea1"></a>
real, dimension(:,:), allocatable, public&#160;</td><td class="memItemRight" valign="bottom"><b>area_atm_model</b></td></tr>
<tr class="separator:ga1ff8193d33aacaafdf1797ff978daea1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad37a8b69f57d73acc0d2039fceadb260"><td class="memItemLeft" align="right" valign="top"><a id="gad37a8b69f57d73acc0d2039fceadb260"></a>
real, dimension(:,:), allocatable, public&#160;</td><td class="memItemRight" valign="bottom"><b>area_ocn_model</b></td></tr>
<tr class="separator:gad37a8b69f57d73acc0d2039fceadb260"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0f5e8fa705ad393644dadd4f16d4e380"><td class="memItemLeft" align="right" valign="top"><a id="ga0f5e8fa705ad393644dadd4f16d4e380"></a>
real, dimension(:,:), allocatable, public&#160;</td><td class="memItemRight" valign="bottom"><b>area_atm_sphere</b></td></tr>
<tr class="separator:ga0f5e8fa705ad393644dadd4f16d4e380"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga13760b65c2019c8c8e4a7038998be022"><td class="memItemLeft" align="right" valign="top"><a id="ga13760b65c2019c8c8e4a7038998be022"></a>
real, dimension(:,:), allocatable, public&#160;</td><td class="memItemRight" valign="bottom"><b>area_ocn_sphere</b></td></tr>
<tr class="separator:ga13760b65c2019c8c8e4a7038998be022"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p><code>xgrid_mod</code> implements exchange grids for coupled models running on multiple processors. An exchange grid is formed from the union of the bounding lines of the two (logically rectangular) participating grids. The exchange grid is therefore the coarsest grid that is a refinement of both participating grids. Exchange grids are used for two purposes by coupled models: (1) conservative interpolation of fields between models uses the exchange grid cell areas as weights and (2) the surface flux calculation takes place on the exchange grid thereby using the finest scale data available. <code>xgrid_mod</code> uses a NetCDF grid specification file containing the grid cell overlaps in combination with the &lt;LINK SRC="ftp://ftp.gfdl.gov/pub/vb/mpp/mpp_domains.F90"&gt; <code>mpp_domains</code>&lt;/LINK&gt; domain decomposition information to determine the grid and processor connectivities. </p>
<dl class="section author"><dt>Author</dt><dd>Michael Winton, Zhi Liang</dd></dl>
<p>xgrid_mod - implements exchange grids. An exchange grid is the grid whose boundary set is the union of the boundaries of the participating grids. The exchange grid is the coarsest grid that is a refinement of each of the participating grids. Every exchange grid cell is a subarea of one and only one cell in each of the participating grids. The exchange grid has two purposes:</p>
<p>(1) The exchange cell areas are used as weights for conservative interpolation between model grids.</p>
<p>(2) Computation of surface fluxes takes place on it, thereby using the finest scale data obtainable.</p>
<p>The exchange cells are the 2D intersections between cells of the participating grids. They are computed elsewhere and are read here from a NetCDF grid file as a sequence of quintuples (i and j on each of two grids and the cell area).</p>
<p>Each processing element (PE) computes a subdomain of each of the participating grids as well as a subset of the exchange cells. The geographic regions corresponding to these subdomains will, in general, not be the same so communication must occur between the PEs. The scheme for doing this is as follows. A distinction is drawn between the participating grids. There is a single "side 1" grid and it does not have partitions (sub-grid surface types). There are one or more "side 2" grids and they may have more than 1 partition. In standard usage, the atmosphere grid is on side 1 and the land and sea ice grids are on side 2. The set of exchange cells computed on a PE corresponds to its side 2 geographic region(s). Communication between the PEs takes place on the side 1 grid. Note: this scheme does not generally allow reproduction of answers across varying PE counts. This is because, in the side 1 "get", exchange cells are first summed locally onto a side 1 grid, then these side 1 contributions are further summed after they have been communicated to their target PE. For the make_exchange_reproduce option, a special side 1 get is used. This get communicates individual exchange cells. The cells are summed in the order they appear in the grid spec. file. </p>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="ga37d5068bd71e797524542322ed6ad788"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga37d5068bd71e797524542322ed6ad788">&#9670;&nbsp;</a></span>get_ocean_model_area_elements()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public xgrid_mod::get_ocean_model_area_elements </td>
          <td>(</td>
          <td class="paramtype">type(domain2d), intent(in)&#160;</td>
          <td class="paramname"><em>domain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=*), intent(in)&#160;</td>
          <td class="paramname"><em>grid_file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read Ocean area element data. </p>
<p>If available in the NetCDF file, this routine will read the AREA_OCN_MODEL field and load the data into global AREA_OCN_MODEL. If not available, then the array AREA_OCN_MODEL will be left unallocated. Must be called by all PEs. </p>

<p class="definition">Definition at line <a class="el" href="xgrid_8F90_source.html#l01563">1563</a> of file <a class="el" href="xgrid_8F90_source.html">xgrid.F90</a>.</p>

</div>
</div>
<a id="ga0d6740065d2355a4ac54b90c8c4545fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0d6740065d2355a4ac54b90c8c4545fb">&#9670;&nbsp;</a></span>some()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public xgrid_mod::some </td>
          <td>(</td>
          <td class="paramtype">type (xmap_type), intent(in)&#160;</td>
          <td class="paramname"><em>xmap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, dimension(:), intent(out)&#160;</td>
          <td class="paramname"><em>some_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=3), intent(in), optional&#160;</td>
          <td class="paramname"><em>grid_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns logical associating exchange grid cells with given side two grid. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">some_arr</td><td>logical associating exchange grid cells with given side 2 grid. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="xgrid_8F90_source.html#l03553">3553</a> of file <a class="el" href="xgrid_8F90_source.html">xgrid.F90</a>.</p>

</div>
</div>
<a id="ga0165e4d85c2583255e8a82c345fa4912"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0165e4d85c2583255e8a82c345fa4912">&#9670;&nbsp;</a></span>xgrid_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public xgrid_mod::xgrid_count </td>
          <td>(</td>
          <td class="paramtype">type (xmap_type), intent(inout)&#160;</td>
          <td class="paramname"><em>xmap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns current size of exchange grid variables. </p>
<dl class="section return"><dt>Returns</dt><dd>integer xgrid_count </dd></dl>

<p class="definition">Definition at line <a class="el" href="xgrid_8F90_source.html#l03283">3283</a> of file <a class="el" href="xgrid_8F90_source.html">xgrid.F90</a>.</p>

</div>
</div>
<a id="gaed7666b9fdf6c25272786857c6bb13ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaed7666b9fdf6c25272786857c6bb13ca">&#9670;&nbsp;</a></span>xgrid_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public xgrid_mod::xgrid_init </td>
          <td>(</td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>remap_method</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the xgrid_mod. </p>
<p>Initialization routine for the xgrid module. It reads the xgrid_nml, writes the version information and xgrid_nml to the log file. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">remap_method</td><td>exchange grid interpolation method. It has four possible values: FIRST_ORDER (=1), SECOND_ORDER(=2). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="xgrid_8F90_source.html#l00566">566</a> of file <a class="el" href="xgrid_8F90_source.html">xgrid.F90</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
