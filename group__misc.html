<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FMS: General Project Documents</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FMS
   </div>
   <div id="projectbrief">Flexible Modeling System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__misc.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle">
<div class="title">General Project Documents</div>  </div>
</div><!--header-->
<div class="contents">

<p>Documentation files not pertaining to specific modules.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:README_8md"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="README_8md.html">README.md</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Documentation files not pertaining to specific modules. </p>


<h3><a id="md_CHANGELOG"></a>CHANGELOG</h3><div class="textblock"><h1>ChangeLog</h1>
All notable changes to this project will be documented in this file.The format is based on <a href="https://keepachangelog.com/en/1.0.0">Keep a Changelog</a>, and this project uses <code>yyyy.rr[.pp]</code>, where <code>yyyy</code> is the year a patch is released, <code>rr</code> is a sequential release number (starting from <code>01</code>), and an optional two-digit sequential patch number (starting from <code>01</code>).<h2>[2021.01] - 2021-03-08</h2>
<h3>Added</h3>
<ul>
<li>MPP: A counter for timers to report how many times a timer section is run</li>
<li>MPP: Adds missing interfaces to be consistent with interfaces that use the OVERLOAD and no_8byte_integer macros in order to allow building without MPI</li>
<li>MPP: Extends interfaces for read and write routines to include 32-bit and 64-bit real data arrays</li>
<li>MPP: Adds unit tests for mpp and mpp_io for all public routines with mixed-precision interfaces and expands on existing tests for mixed-precision</li>
<li>Adds an .editorconfig file with the project's preferred editor configuration</li>
<li>A variable MODDIR in configure.ac for use in Makefiles to find required Fortran module files</li>
<li>Adds FMS description web page as a markdown file <h3>Changed</h3>
</li>
</ul>
<ul>
<li>DOCS: Updates various modules to doxygen style comments and makes adjustments to correctly generate doxygen documentation through the build system</li>
<li>PLATFORM: changes usage of platform.h to platform_mod and it's associated data types</li>
<li>Changes all previous uses of flush subroutine calls to function calls</li>
<li>Changes travis CI to Github actions CI and removed all trailing whitespace <h3>Removed</h3>
</li>
</ul>
<h3>Fixed</h3>
<ul>
<li>MPP: Fixed a bug causing mpp_get_UG_domain_tile_pe_inf to seg fault from the incorrect assignment of an optional argument</li>
<li>FMS: Fixes issues with FMS unit tests failing from pointer allocations by reworking deallocate_unstruct_pass_type</li>
<li>MPP_IO: Fixes unintentional printing of file attributes</li>
<li>An issue with the automake build system causing unnecessary rebuilds of source files</li>
<li>Fixes CMake build of the FMS library to install configuration files in the appropriate directories; and for OpenMP dependencies to the private <h3>Tag Commit Hashes</h3>
</li>
</ul>
<ul>
<li>2021.01-alpha1 (dbe8a1060fb33167c2d12239484226b40fb01fd0)</li>
<li>2021.01-alpha2 (b94eb18fe8e686c5958cbbacc4cf9130873afc85)</li>
<li>2021.01-beta1 (4dcc9a795d9ba0cc959ebd93dda5be5f8473545c)</li>
</ul>
<h2>[2020.04] - 2020-12-07</h2>
<h3>Added</h3>
<ul>
<li>DIAG_MANAGER: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>DIAG_MANAGER: A check is added before a time axis is registered to check if the time axis is registered as a variable</li>
<li>DIAG_MANAGER: A unit test was added to test the optional <code>new_file_freq</code> functionality</li>
<li>XGRID: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>INTERPOLATOR: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>AMIP_INTERP: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>TOPOGRAPHY: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>DATA_OVERRIDE: A namelist flag called <code>use_mpp_bug</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>DATA_OVERRIDE: A namelist flag called <code>reproduce_null_char_bug_flag</code> if set to .true. and fms2_io is being used, it will reproduce the mpp_io bug where the axis bounds were calculated instead of read. The default is .false. A unit test was added to test the functionality of <code>get_grid_version_1</code></li>
<li>FMS2_IO: A unit test was added to test the functionality of <code>get_valid</code> and <code>is_valid</code> <h3>Changed</h3>
</li>
</ul>
<ul>
<li>The autotools build has been changed to copy each subdirectory module (.mod) files to a common .mod directory located at the top of the source directory. This change simplifies the include path specifications.</li>
<li>Use F90 module files for external libraries (MPI and NetCDF) for improved interface checking, thereby removing the reliance on library header include files.</li>
<li>FMS2_IO: Changed how nest file names are created to be consistent with mpp_io</li>
<li>CMAKE: Changed visibility of FMS OpenMP libraries to private in order to avoid conflicts with model libraries <h3>Removed</h3>
</li>
</ul>
<ul>
<li>LIBFMS: The flag -Duse_mpp_io should not be used and will cause a crash</li>
<li>LIBFMS: Macros and logic for interfacing to the Flexible File I/O library</li>
<li>LIBFMS: Macros for SGI MIPSpro compilers, including: mpp_node function and SGI Irix specific high resolution timer</li>
<li>LIBFMS: Macros for IBM AIX compilers</li>
<li>LIBFMS: Files in mpp supporting the CRAY SHMEM communications library</li>
<li>LIBFMS: Files in mpp for the SGI PSET approach for communication via GSM</li>
<li>MPP_IO: removed left over #ifdefs from backwards compatibility changes <h3>Fixed</h3>
</li>
</ul>
<ul>
<li>DATA_OVERRIDE: Fixed a bug in <code>get_grid_version_1</code> where the variable_size calls were not correct</li>
<li>FMS2_IO: Fixed a bug in <code>get_valid</code> where the mpp_broadcast calls were done inside <code>if (root_pe)</code> blocks The fms2_io unit tests were modified so they can work with the AOCC compiler</li>
<li>XGRID: Fixed a bug in <code>load_xgrid</code> by checking if a dimension exists before calling <code>get_dimension_size</code> to avoid <code>FATAL: NetCDF: Invalid dimension ID or name</code> crashes</li>
<li>DIAG_MANAGER: Fixed a bug where files were getting written with redundant time_bounds data</li>
<li>CMAKE: Fixed a bug causing the build to fail on latest versions of Ubuntu</li>
<li>CMAKE: Fixed a bug that caused the build to fail from incorrect source paths <h3>Tag Commit Hashes</h3>
</li>
</ul>
<ul>
<li>2020.04-alpha1 (2428bb182133b8062432ee1b15974739753ca470)</li>
<li>2020.04-alpha2 (ad9915d83a2f34610cd748fd85889ba1f0f1fc02)</li>
<li>2020.04-alpha3 (e7e48839ab25cc9405abe5d8418e1b6ee6fb2d69)</li>
<li>2020.04-beta1 (6d3ac620423e7ede412e4bb1b36c338775d95193)</li>
</ul>
<h2>[2020.03] - 2020-10-08</h2>
<h3>Added</h3>
<ul>
<li>FMS2_IO: Adds header_buffer_val to the fms2io namelist which sets the netcdf header size in bytes. The default value is 16kb</li>
<li>FMS2_IO: Adds netcdf_default_format to the fms2io namelist which allows the user to change the netcdf file type. The default value is 64bit.</li>
<li>FMS2_IO: Adds support to read netcdf string global attributes</li>
<li>FMS2_IO: Adds an optional argument to open_file, <code>dont_add_res_to_filename</code>, which indicates that the filename should not be modified (default adds .res to restart file name)</li>
<li>FMS2_IO: Modifies the <code>register_variable_attribute</code> and <code>register_global_attribute</code> interfaces by adding str_len as an argument. This is a workaround to get fms2io to work with PGI because they don't support class (*) with len=*.</li>
<li>FMS2_IO: Adds unit test that tests <code>write_data</code> and <code>read_data</code> when using a domain with a mask table</li>
<li>FMS2_IO: Adds fms2io’s version of get_mosaic_tile_grid</li>
<li>MPP_IO: Adds <code>-Duse_mpp_io</code> compile option for data_override, interpolator, amip_interp, diag_manager, topography, and xgrid to select using mpp_io instead of fms2_io</li>
<li>MPP_INIT: Adds unit tests for routines/functions that are called in mpp_init</li>
<li>CMAKE: A cmake build system has been added with a CI build using cmake <h3>Changed</h3>
</li>
</ul>
<ul>
<li>FMS2_IO: Improves performance of previous release by gathering the domain decomposed data into one global buffer and doing one write rather than doing multiple reads</li>
<li>DATA_OVERRIDE: Changes line in time_interp_external2 to enable 3D overrides</li>
</ul>
<h3>Fixed</h3>
<ul>
<li>DATA_OVERRIDE[2]: Fixes a crash when doing ongrid data_override calls with a domain with halos</li>
<li>DIAG_MANAGER[2]: Fixes an issue where time_bnds were written incorrectly for the last time stamp</li>
<li>DIAG_MANAGER: Regional diagnostics with a mask table now work</li>
<li>FMS2_IO: Unit test includes fms2io_init call to improve functionality</li>
<li>MPP: BOZ literals that are used in variable declaration are converted to integers using the int() function.</li>
<li>MPP_DOMAINS2: Fixed unit test</li>
<li>FMS_IO: Changes the logic in get_tile_string to fix bug where tile numbers 9 and 99 produce an inappropriate error</li>
</ul>
<h3>Tag Commit Hashes</h3>
<ul>
<li>2020.03-beta4 (4d38679c1e18e920feb03d69f8a9762eb6a047aa)</li>
<li>2020.03-beta3 (521a15135a99d1f2da7d82f238353945f82ce1dd)</li>
<li>2020.03-beta2 (3dae0dfa405d555ecc09bbd2d60a1be24461f69e)</li>
<li>2020.03-beta1 (f7f1c1c73c1f478a53e84caee6aff2fa840ad086)</li>
<li>2020.03-alpha1 (2dd30b7ca0ac75a4a38b969e4a6d446eb395b4dd)</li>
</ul>
<h2>[2020.02] - 2020-05-01</h2>
<h3>Added</h3>
<ul>
<li>FMS2_IO: An fms2_io_nml namelist has been created. It includes the variable ncchksz. This is the replacement for the environment variable NC_BLKSZ set in model run scripts and used by mpp_io. The default value is 64 KB. Any time a file is opened in fms2_io (nf90_open or nf90_create), the optional argument <code>chunksize=ncchksz</code> is passed to the NetCDF library. NetCDF attempts to use this value to control the blocksize utilized for reads and writes of data from the filesystem.</li>
<li>FMS2_IO: Adds support to <code>compute_global_cheksum.inc</code> for <code>real32</code>, assuming the flag <code>-DOVERLOAD_R4</code> is used when compiling.</li>
</ul>
<h3>Changed</h3>
<ul>
<li>MPP_DOMAINS - nesting: The logic supporting nested domains for mosaic grids has been overhauled and extended. FMS now supports multiple nests and telescoping nests (nest embedded within a nest). The requirement for a nest to lie wholly within a single tile has been relaxed and a first-level nest may cross tile boundaries, but may not contain a tile corner. Communications for two-way nesting have also been improved. The 2019 December Public Release and 2020.02 GFDL Release within the <a href="https://github.com/NOAA-GFDL/GFDL_atmos_cubed_sphere">GFDL_atmos_cubed_sphere</a> have been updated and are compatible with this release of FMS.</li>
<li>FMS2_IO: The intent of fileobj is changed from (in) to (inout) in netcdf_restore_state_wrap, restore_domain_state, and netcdf_restore_state because the file object type has a pointer that is being reassigned in one of the routines lower in the call stack.</li>
</ul>
<h3>Deprecated</h3>
<ul>
<li>MPP_DOMAINS - nesting: The initial nesting implementation is no longer supported. Please see the Changed::MPP_DOMAINS sub-entry under.</li>
</ul>
<h3>Removed</h3>
<ul>
<li>GENERAL: References to the macro _ALLOCATABLE have been replaced with “allocatable”, _ALLOCATED has been replaced with “allocated”, and _NULL has been removed. It is now assumed that all compilers support the Fortran 2003 standard. The macros still exist in fms_platforms.h for compatibility within other components.</li>
<li>DIAG_MANAGER: “fms_platform.h” is no longer included in any of the diag_manager routines. Instead, fms_platform_mod is now being use-associated where necessary. This fixes an issue for debuggers not providing correct line numbers.</li>
</ul>
<h3>Tag Commit Hashes</h3>
<ul>
<li>2020.02-beta1 (bbc6f8d33cfb75a411bbcd3f8423fa74b8b7cdfd)</li>
<li>2020.02-beta2 (6242941a632f6e261234f3a575e59efa1bfb1b36)</li>
<li>2020.02-beta3 (e6fd03b070eb1ba8ffbca740fd69681ee16d6be7)</li>
</ul>
<h2>[2020.01] - 2020-03-13</h2>
<h3>Added</h3>
<ul>
<li>Adds the modules <code>axis_utils2</code>, <code>mosaic2</code>, and <code>time_interp_external2</code> that use <code>fms2_io</code></li>
<li>Adds unit tests for thread affinity in test_fms/affinity</li>
<li>Autotools unit tests are now run with <code>srun, mpirun</code>, or <code>aprun</code> (whichever is present on your system)</li>
<li><code>fms2_io</code> provides three new derived types, which target the different I/O paradigms used in GFDL GCMs:<ul>
<li>type(FmsNetcdfFile_t) - This type provides a thin wrapper over the netCDF4 library, but allows the user to assign a “pelist” to the file. If a pelist is assigned, only the first rank on the list directly interacts with the netCDF library, and performs broadcasts to relay the information to the rest of the ranks on the list. This derived type also allows the user to perform “compressed” reads/writes and restart variable “registration” (i.e. the ability to store pointers to user-defined/allocated buffers) and reads/writes in a manner similar to the existing calls in fms_io.</li>
<li>type(FmsNetcdfUnstructuredDomainFile_t) - This type extends the FmsNetcdfFile_t type to support “domain-decomposed” reads/writes on a user defined mpp_domains unstructured grid. Users are required to inform the FMS2_io module which dimensions correspond to the unstructured grid using the appropriate <code>register_axis</code> call before any domain-decomposed reads/writes can be performed.</li>
<li>type(FmsNetcdfDomainFile_t) - This type extends the FmsNetcdfFile_t type to support “domain-decomposed” reads/writes on a user-defined <code>mpp_domains</code> two-dimensional lon-lat or cubed-sphere grid. Users are required to inform the <code>fms2_io</code> module which dimensions (‘x’ or ‘y’) correspond to the two-dimensional grid using the appropriate <code>register_axis</code> calls before any domain-decomposed reads/writes can be performed.</li>
</ul>
</li>
<li><code>fms2_io</code> requires the user to manage objects of the types described above. Calls to <code>open_file</code> (<code>close_file</code>) act as constructors (destructors) for each of the objects, and must be explicitly made by the user. Each object must be constructed before any I/O can be performed. Examples describing how to use these new types are available in <a href="https://github.com/NOAA-GFDL/FMS/tree/master/test_fms/fms2_io">test_fms/fms2_io</a></li>
<li><code>fms2_io</code> treats *_FillValue* attributes as <em>valid_max</em> or <em>valid_min</em> range specifiers if none of <em>valid_range</em>, <em>valid_min</em>, and <em>valid_max</em> are specified as described in these <a href="https://www.unidata.ucar.edu/software/netcdf/docs/attribute_conventions.html">netcdf conventions</a></li>
</ul>
<h3>Changed</h3>
<ul>
<li>The <code>diag_manager</code> IO is handled by fms2_io instead of mpp_io. Default behavior assumes that the mpp_io namelist variable is set to <em>cf_compliant = .true.</em></li>
<li>The user must specify the diagnostic attributes that they want to write to the output files. Example: If there is no <em>units</em> attribute, then the variable metadata will not include <em>units</em>, and it will not automatically add <em>units = “none”</em>.</li>
<li>Calls to <code>register_diag_axis</code> for an X or Y axis that is shifted from the <em>CENTER</em> position need to include the optional argument <em>domain_position</em> and should be equal to <em>EAST</em> or <em>NORTH</em> based on the position relative to the domain. EAST and <em>NORTH</em> are exposed through <code>diag_manager_mod</code>.</li>
<li>Changed the handling of <em>average_T</em> and <em>time_bnds</em> variables so that they are set to values that are sent in and are not manipulated as was the case in mpp_io.</li>
<li><code>interpolator</code>, <code>xgrid</code>, <code>data_override</code>, and <code>amip_interp</code> now call <code>fms2_io</code> routines</li>
<li>Support for enabling/disabling quad-precision (used in certain calculations) has been changed to a hard on/off switch. Default behavior is quad-precision disabled. To enable, add the following CPP macro -DENABLE_QUAD_PRECISION. This change was necessary to remove guessing at the proper setting via a mix of compiler vendor and system-defined environment variables which resulted in different behaviors on machines unbeknownst to the user.</li>
</ul>
<h3>Deprecated</h3>
<ul>
<li>fms2_io does <b>NOT</b> use the <em>scale_factor</em>, <em>add_offset</em>, or other attributes to manipulate the data. The variable/data is returned to the caller as it appears in the file. All post-read data manipulations should be handled by the caller. <h3>Removed</h3>
</li>
</ul>
<ul>
<li>Removes the use of bats when running unit tests</li>
</ul>
<h3>Tag Commit Hashes</h3>
<ul>
<li>2020.01-alpha1 (09dc8e9e0f1c852e9e9190834176d16943cd3729)</li>
<li>2020.01-beta1 (e1c0d9d01d844938adc0d18afa09532f336bcdfe)</li>
<li>2020.01-beta2 (b68de5382a5ce631ddd6167de8d85f7c9ae54351)</li>
</ul>
<h2>[2019.01] - 2019-11-26</h2>
<h3>Added</h3>
<ul>
<li>switch from "city" versioning style to <code>yyyy.&lt;2_digit_version_number&gt;[.&lt;2-digit-patch number&gt;]</code> style</li>
<li>main development branch is <code>master</code> instead of <code>dev/master</code></li>
<li>affinity handling moved to the affinity directory</li>
<li>support for building with autotools</li>
<li><a href="include/fms_platform.h">fms_platform.h</a> contains directives that support building on macOS</li>
<li>unit and build tests are available in the [test_fms](test_fms) directory</li>
<li>updated <a href="fv3gfs/makefile">fv3gfs/makefile</a> for use with current EMC build system <h3>Fixed</h3>
</li>
</ul>
<ul>
<li>Fixed <code>time_interp_missing</code> parameter in <a href="time_interp/time_interp_external.F90">time_interp/time_interp_external.F90</a> to be within range when compiled in mixed-mode.</li>
<li>reverted <code>QUAD_PRECISION</code> cpp macro behavior to pre-Xanadu behavior in <a href="include/fms_platform.h">include/fms_platform.h</a></li>
<li>Fixed a GNU compiler issue with the logical check to set the netCDF fill value in <code>mpp_io_write</code> by separating the logical <code>.AND.</code> into nested <code>if</code> statements. </li>
</ul>
</div>

<h3><a id="md_CMAKE_INSTRUCTIONS"></a>CMAKE_INSTRUCTIONS</h3><div class="textblock"><h1>Instructions for building FMS with cmake</h1>
<h2>1. Environment Variables</h2>
<h3>For GNU compilers on Linux with the bash shell:</h3>
<div class="fragment"><div class="line">export FC=mpifort</div>
<div class="line">export CC=mpicc</div>
</div><!-- fragment --><h3>For Intel Compilers on Linux with the bash shell:</h3>
<div class="fragment"><div class="line">export FC=mpiifort</div>
<div class="line">export CC=mpiicc</div>
</div><!-- fragment --><h3>NetCDF is provided via the <code>nc-config</code> command:</h3>
<div class="fragment"><div class="line">export NetCDF_ROOT=`nc-config --prefix`</div>
</div><!-- fragment --><h2>2. Build and install FMS with CMake</h2>
<code>&lt;prefix&gt;</code> is the full install directory for FMS provided by user<div class="fragment"><div class="line">cd FMS</div>
<div class="line">mkdir -p build &amp;&amp; cd build</div>
<div class="line">cmake -DCMAKE_INSTALL_PREFIX=&lt;prefix&gt; ..</div>
<div class="line">make -j4</div>
<div class="line">make install</div>
</div><!-- fragment --><h3>User configurable options:</h3>
By default, FMS is built without <code>OpenMP</code> and in <code>single precision (r4)</code>The following build options are available: </p><div class="fragment"><div class="line">-DOPENMP   &quot;Build FMS with OpenMP support&quot; DEFAULT: OFF</div>
<div class="line">-D32BIT    &quot;Build 32-bit (r4) FMS library&quot; DEFAULT: ON</div>
<div class="line">-D64BIT    &quot;Build 64-bit (r8) FMS library&quot; DEFAULT: OFF</div>
<div class="line"> </div>
<div class="line">-DINTERNAL_FILE_NML     &quot;Enable compiler definition -DINTERNAL_FILE_NML&quot;     DEFAULT: ON</div>
<div class="line">-DENABLE_QUAD_PRECISION &quot;Enable compiler definition -DENABLE_QUAD_PRECISION&quot; DEFAULT: ON</div>
<div class="line">-DGFS_PHYS              &quot;Enable compiler definition -DGFS_PHYS&quot;              DEFAULT:OFF</div>
<div class="line">-DLARGEFILE             &quot;Enable compiler definition -Duse_LARGEFILE&quot;         DEFAULT:OFF</div>
</div><!-- fragment --><h2>3. Installation structure</h2>
When the above command finishes, the <code>&lt;prefix&gt;</code> will have an <code>include_r4</code> and a <code>lib</code> directory. The <code>lib</code> directory will have these files:<div class="fragment"><div class="line">libfms_r4.a</div>
<div class="line">cmake/fms/fms-targets.cmake</div>
<div class="line">cmake/fms/fms-targets-release.cmake</div>
<div class="line">cmake/fms/fms-config.cmake</div>
<div class="line">cmake/fms/fms-config-version.cmake</div>
</div><!-- fragment --><h2>4. Using FMS in your application</h2>
FMS built with <code>cmake</code> provides transient targets with its package configuration. To be able to look for FMS in your application, set the following environment variable: </p><div class="fragment"><div class="line">export FMS_ROOT=&lt;prefix&gt;</div>
</div><!-- fragment --><p> where <code>&lt;prefix&gt;</code> is the full path to FMS installation.To find FMS in your application <code>CMakeLists.txt</code>:<div class="fragment"><div class="line">find_package(FMS)</div>
</div><!-- fragment -->To link your application with FMS library: </p><div class="fragment"><div class="line">target_link_libraries(appName FMS::fms_r4)</div>
</div><!-- fragment -->If your application does not provide a means to locate the NetCDF installation via cmake, this may help: </p><div class="fragment"><div class="line">-DCMAKE_MODULE_PATH=&lt;FMS_SRC_DIR&gt;/cmake</div>
</div><!-- fragment --> </div>

<h3><a id="md_CODE_OF_CONDUCT"></a>CODE_OF_CONDUCT</h3><div class="textblock"><h1>Code of Conduct</h1>
<h2>Our Pledge</h2>
In the interest of fostering an open and welcoming environment, we as contributors and maintainers pledge to making participation in our project and our community a harassment-free experience for everyone, regardless of age, body size, disability, ethnicity, sex characteristics, gender identity and expression, level of experience, education, socio-economic status, nationality, personal appearance, race, religion, or sexual identity and orientation.<h2>Our Standards</h2>
Examples of behavior that contributes to creating a positive environment include:<ul>
<li>Using welcoming and inclusive language</li>
<li>Being respectful of differing viewpoints and experiences</li>
<li>Gracefully accepting constructive criticism</li>
<li>Focusing on what is best for the community</li>
<li>Showing empathy towards other community members</li>
</ul>
Examples of unacceptable behavior by participants include:<ul>
<li>The use of sexualized language or imagery and unwelcome sexual attention or advances</li>
<li>Trolling, insulting/derogatory comments, and personal or political attacks</li>
<li>Public or private harassment</li>
<li>Publishing others’ private information, such as a physical or electronic address, without explicit permission</li>
<li>Other conduct which could reasonably be considered inappropriate in a professional setting</li>
</ul>
<h2>Our Responsibilities</h2>
Project maintainers are responsible for clarifying the standards of acceptable behavior and are expected to take appropriate and fair corrective action in response to any instances of unacceptable behavior.Project maintainers have the right and responsibility to remove, edit, or reject comments, commits, code, wiki edits, issues, and other contributions that are not aligned to this Code of Conduct, or to ban temporarily or permanently any contributor for other behaviors that they deem inappropriate, threatening, offensive, or harmful.<h2>Scope</h2>
This Code of Conduct applies both within project spaces and in public spaces when an individual is representing the project or its community. Examples of representing a project or community include using an official project e-mail address, posting via an official social media account, or acting as an appointed representative at an online or offline event. Representation of a project may be further defined and clarified by project maintainers.<h2>Enforcement</h2>
Instances of abusive, harassing, or otherwise unacceptable behavior may be reported by contacting the project team at <a href="#" onclick="location.href='mai'+'lto:'+'cli'+'ma'+'te.'+'mo'+'del'+'.i'+'nfo'+'@n'+'oaa'+'.g'+'ov'; return false;">clima<span style="display: none;">.nosp@m.</span>te.m<span style="display: none;">.nosp@m.</span>odel.<span style="display: none;">.nosp@m.</span>info<span style="display: none;">.nosp@m.</span>@noaa<span style="display: none;">.nosp@m.</span>.gov</a>. All complaints will be reviewed and investigated and will result in a response that is deemed necessary and appropriate to the circumstances. The project team is obligated to maintain confidentiality with regard to the reporter of an incident. Further details of specific enforcement policies may be posted separately.Project maintainers who do not follow or enforce the Code of Conduct in good faith may face temporary or permanent repercussions as determined by other members of the project’s leadership.<h2>Attribution</h2>
This Code of Conduct is adapted from the <a href="https://www.contributor-covenant.org/">Contributor Covenant</a>, version 1.4, available at <a href="https://www.contributor-covenant.org/version/1/4/code-of-conduct.html">https://www.contributor-covenant.org/version/1/4/code-of-conduct.html</a> </div>

<h3><a id="md_CODE_STYLE"></a>CODE_STYLE</h3><div class="textblock"><h1>Coding Style</h1>
<h2>General</h2>
<ul>
<li>Trim all trailing whitespace from every line (some editors can do this automatically).</li>
<li>No &lt;Tab&gt; characters.</li>
<li>Supply a header for each file with a description of the file and the author(s) name or GitHub ID.</li>
<li>A copy of the <a href="https://www.gnu.org/licenses/lgpl-3.0.en.html">Gnu Lesser General Public License</a> must be included at the top of each file.</li>
<li>Documentation should be written so that it can be parsed by <a href="http://www.doxygen.nl/">Doxygen</a>.</li>
<li>All variables should be defined, and include units. Unit-less variables should be marked <code>unitless</code></li>
<li>Provide detailed descriptions of modules, interfaces, functions, and subroutines</li>
<li>Define all function/subroutine arguments, and function results (see below)</li>
<li>Follow coding style of the current file, as much as possible.</li>
</ul>
<h2>Fortran</h2>
<h3>General</h3>
<ul>
<li>Use Fortran 95 standard or newer</li>
<li>Two space indentation</li>
<li>Use <code>KIND</code> parameters from intrinsic fortran modules such as iso_fortran_env or iso_c_binding to ensure portability</li>
<li>Never use implicit variables (i.e., always specify <code>IMPLICIT NONE</code>)</li>
<li>Lines must be &lt;= 120 characters long (including comments)</li>
<li>logical, compound logical, and relational if statements may be one line, using “&amp;” for line continuation if necessary: <div class="fragment"><div class="line"><span class="keywordflow">if</span>(file_exists(filename)) <span class="keyword">call </span>open_file(fileobj,filename, is_restart=.false)</div>
</div><!-- fragment --></li>
<li>Avoid the use of <code>GOTO</code> statements</li>
<li>Avoid the use of Fortran reserved words as variables (e.g. <code>DATA</code>, <code>NAME</code>)</li>
<li>Avoid the use of <code>COMMON</code> blocks</li>
</ul>
<h3>Derived types</h3>
<ul>
<li>Type names must be in CapitalWord format.</li>
<li>Variables names must be in underscore_word format.</li>
<li>All member variables must be private.</li>
<li>Doxygen description on the line before the type definition.</li>
<li>Inline doxygen descriptions for all member variables.</li>
</ul>
<h2>Functions</h2>
<ul>
<li>Functions should include a result variable on its own line, that does not have a specific intent.</li>
<li>Inline doxygen descriptions for all arguments, except the result variable.</li>
<li>Doxygen description on the line(s) before the function definition. This must specify what the function is returning using the <code>@return</code> doxygen keyword.</li>
</ul>
<h2>Blocks</h2>
<ul>
<li>terminate <code>do</code> loops with <code>enddo</code></li>
<li>terminate block <code>if</code>, <code>then</code> statements with <code>endif</code></li>
</ul>
<h2>OpenMP</h2>
<ul>
<li>Directives should start at the beginning of the line, and be in lowercase.</li>
<li>All openMP directives should specify default(none), and then explicitly list all shared and private variables.</li>
<li>All critical sections must have a unique name.</li>
</ul>
<h2>Fortran Example</h2>
<div class="fragment"><div class="line"><span class="comment">!***********************************************************************</span></div>
<div class="line"><span class="comment">!*                   GNU Lesser General Public License</span></div>
<div class="line"><span class="comment">!*</span></div>
<div class="line"><span class="comment">!* This file is part of the GFDL Flexible Modeling System (FMS).</span></div>
<div class="line"><span class="comment">!*</span></div>
<div class="line"><span class="comment">!* FMS is free software: you can redistribute it and/or modify it under</span></div>
<div class="line"><span class="comment">!* the terms of the GNU Lesser General Public License as published by</span></div>
<div class="line"><span class="comment">!* the Free Software Foundation, either version 3 of the License, or (at</span></div>
<div class="line"><span class="comment">!* your option) any later version.</span></div>
<div class="line"><span class="comment">!*</span></div>
<div class="line"><span class="comment">!* FMS is distributed in the hope that it will be useful, but WITHOUT</span></div>
<div class="line"><span class="comment">!* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><span class="comment">!* FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span></div>
<div class="line"><span class="comment">!* for more details.</span></div>
<div class="line"><span class="comment">!*</span></div>
<div class="line"><span class="comment">!* You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment">!* License along with FMS.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment">!***********************************************************************</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">!&gt; @file</span></div>
<div class="line"><span class="comment">!! @brief Example code</span></div>
<div class="line"><span class="comment">!! @author &lt;developer&gt;</span></div>
<div class="line"><span class="comment">!! @email gfdl.climate.model.info@noaa.gov</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">module</span> example_mod</div>
<div class="line">  use, <span class="keywordtype">intrinsic</span> :: iso_fortran_env, only: int32, real32</div>
<div class="line">  <span class="keywordtype">use </span>util_mod, <span class="keywordtype">only</span>: util_func1</div>
<div class="line">  <span class="keywordtype">implicit none</span></div>
<div class="line">  <span class="keywordtype">private</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">public</span> :: sub1</div>
<div class="line">  <span class="keywordtype">public</span> :: func1</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  !&gt; @brief Doxygen description of type.</span></div>
<div class="line">  <span class="keyword">type</span>,<span class="keyword">public</span> :: customtype</div>
<div class="line">    <span class="keywordtype">private</span></div>
<div class="line">    <span class="keywordtype">integer(kind=INT32)</span> :: a_var<span class="comment"> !&lt; Inline doxygen description.</span></div>
<div class="line"><span class="keywordtype">    real</span>(kind=real32),<span class="keywordtype">dimension(:)</span>,<span class="keywordtype">allocatable</span> :: b_arr <span class="comment">!&lt; long description</span></div>
<div class="line"><span class="comment">                                                        !! continued on</span></div>
<div class="line"><span class="comment">                                                        !! multiple lines.</span></div>
<div class="line">  <span class="keyword">endtype </span>customtype</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">contains</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  !&gt; @brief Doxygen description.</span></div>
<div class="line">  <span class="keyword">subroutine </span>sub1(arg1, &amp;</div>
<div class="line">    &amp; arg2, &amp;</div>
<div class="line">    &amp; arg3)</div>
<div class="line"><span class="keywordtype">    real</span>(kind=real32),<span class="keywordtype">intent(in)</span> :: arg1 <span class="comment">!&lt; Inline doxygen description.</span></div>
<div class="line">    <span class="keywordtype">integer(kind=INT32)</span>,<span class="keywordtype">intent(inout)</span> :: arg2<span class="comment"> !&lt; Inline doxygen description.</span></div>
<div class="line">    <span class="keywordtype">character(len=*)</span>,<span class="keywordtype">intent(inout)</span> :: arg3<span class="comment"> !&lt; Long inline doxygen</span></div>
<div class="line"><span class="comment">                                           !! description.</span></div>
<div class="line">  <span class="keyword">end subroutine </span>sub1</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  !&gt; @brief Doxygen description</span></div>
<div class="line"><span class="comment">  !! @return Function return value.</span></div>
<div class="line">  <span class="keyword">function </span>func1(arg1, &amp;</div>
<div class="line">    &amp; arg2) &amp;</div>
<div class="line">    &amp; result(res)</div>
<div class="line">    <span class="keywordtype">integer(kind=INT32)</span>,<span class="keywordtype">intent(in)</span> :: arg1<span class="comment"> !&lt; Inline doxygen description</span></div>
<div class="line">    <span class="keywordtype">integer(kind=INT32)</span>,<span class="keywordtype">intent(in)</span> :: arg2<span class="comment"> !&lt; Inline doxygen description</span></div>
<div class="line">    <span class="keywordtype">integer(kind=INT32)</span> :: res</div>
<div class="line">  <span class="keyword">end function </span>func1</div>
<div class="line"> </div>
<div class="line"><span class="keyword">end module </span>example_mod</div>
</div><!-- fragment --><h2>C/C++</h2>
<h3>General</h3>
<ul>
<li>C code is written in GNU style. Each new level in a program block is indented by 2 spaces. Braces start on a new line, and are also indented by 2 spaces.</li>
<li>See the <a href="https://developer.gnome.org/programming-guidelines/stable/c-coding-style.html.en">Gnome C coding style guide</a> for more information </li>
</ul>
</div>

<h3><a id="md_CONTRIBUTING"></a>CONTRIBUTING</h3><div class="textblock"><h1>Contributing To libFMS</h1>
Thank you for taking time to contribute.libFMS is a software framework for supporting the efficient development, construction, execution, and scientific interpretation of atmospheric, oceanic, and climate system models.Contributions to this project are released to the public under the <a class="el" href="group__misc.html">projects open source license</a>.What follows is a set of guidelines and how-tos for contributing to libFMS. These are guidelines, not rules. Use your best judgement and feel free to propose changes to this document in a pull request.Table of Contents</p><ul>
<li><a href="#code-of-conduct">Code of Conduct</a></li>
<li><a href="#quick-start-workflow">Quick Start Workflow</a></li>
<li><a href="#support">Support</a></li>
<li><a href="#issues">Issues</a></li>
<li><a href="#pull-requests">Pull Requests</a></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#styleguides">Styleguides</a></li>
<li><a href="#maintainer-help">Maintainer Help</a></li>
</ul>
<h2>Code of Conduct</h2>
This project and everyone participating in it is governed by the <a class="el" href="group__misc.html">Code of Conduct</a>. By participating, you are expected to uphold this code. Please report unacceptable behavior to <a href="#" onclick="location.href='mai'+'lto:'+'gfd'+'l.'+'cli'+'ma'+'te.'+'mo'+'del'+'.i'+'nfo'+'@n'+'oaa'+'.g'+'ov'; return false;">gfdl.climate.model.info@noaa.gov</a>.<h2>Quick Start Workflow</h2>
<ol type="1">
<li>Create an issue that describes the change, or feature request</li>
<li>Fork the project</li>
<li>Create a feature branch off an up-do-date <code>master</code> branch</li>
<li>Update the tests and code</li>
<li>Push the commits to your fork</li>
<li>Submit a pull request to the <code>master</code> branch</li>
</ol>
<h2>Support</h2>
To get support, open a GitHub issue using the support issue template. Please be as descriptive as possible. See the <a href="#issues">Issues</a> section for more details.Support for this project is primarily accomplished via this project’s community. Additional support may be offered from related communities (e.g. <a href="https://github.com/NOAA-GFDL/MOM6">MOM6</a> or by members of the GFDL <a href="https://www.gfdl.noaa.gov/modeling-systems">Modeling Systems</a> Group. The members of the Modeling Systems group are the main developers and maintainers of this project. Modeling Systems is a small group, and our ability to offer support is limited. Please be patient when requesting support.<h2>Issues</h2>
When contributing to this project, please first open an issue using the template that best matches the change type.<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Template   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Bug   </td><td class="markdownTableBodyNone">Report a bug, or unexpected behavior    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Feature Request   </td><td class="markdownTableBodyNone">A requested feature or change to the code    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Support   </td><td class="markdownTableBodyNone">Request for support. Please see the <a href="#support">Support</a> section.   </td></tr>
</table>
The issue title should be short and descriptive. The issue description should be clear and concise. Include enough information to help others reproduce the issue, or understand the change requested. Use <a href="https://guides.github.com/features/mastering-markdown/">GitHub flavored markdown</a> to format the message, and include links to references.<h2>Pull Requests</h2>
Submit pull requests for bug fixes, improvements, including tests, or alerts to particular problems in the code. We perform merge requests based on an internal GFDL schedule that addresses the needs of the GFDL scientists. This release schedule is better described in the Release Schedule sections. We follow the <a href="https://guides.github.com/activities/forking/">GitHub fork-pull request workflow</a> workflow, briefly described in the <a href="#quick-start-workflow">Quick Start Workflow</a> section. When creating the pull request, please select a template that best matches the type of changes.Please keep the changes in a single pull to be as small as possible to help reviewer(s) quickly evaluate changes. If you do have a large update, try to split the update into small, logical pull requests. If the update includes code refactoring, please submit a pull request that includes just the code refactoring.Once a pull request is created, a member of the Modeling Systems group will review the changes, and, if necessary, will work with the author of the pull request to modify their code changes. Note that merging pull requests is contingent on several factors, including the ability to support the code changes long-term, portability, and the scope of the impact on the code base. Therefore, Modeling Systems does not guarantee that all pull requests will be accepted, even if the changes pass the initial testing phases, and are otherwise correct.<h2>Tests</h2>
FMS uses TravisCI and gitlab-CI to run build tests for libFMS. Users may create unit tests, code coverage tests, and regression tests for new and existing code in yaml (.yml) files. Github provides a guide (<a href="https://help.github.com/en/articles/about-continuous-integration">https://help.github.com/en/articles/about-continuous-integration</a>) for implementing CI tests.<h2>Code Style</h2>
Code updates should follow the coding style for the project, contained in <a class="el" href="group__misc.html">CODE_STYLE.md</a>.<h2>Release Schedule</h2>
Releases will be tagged using the format <code>yyyy.rr[.pp]</code>, where <code>yyyy</code> is the 4-digit year, <code>rr</code> is the 2-digit release number, and <code>pp</code> is the 2-digit patch number. Preliminary releases mean for testing (i.e., code that is still under development) will be marked <code>yyyy.rr.alpha.pp</code> or <code>yyyy.rr.beta.pp</code>. Alpha tags mark code updates that are intended for developers to include in their baseline regression tests to determine whether the code contains bugs not encountered during baseline testing. Beta tags are intended for a wider audience of developers and end users to ensure that their simulations run as expected and reproduce prior results. </div>

<h3><a id="md_INSTALL"></a>INSTALL</h3><div class="textblock"><h1>libFMS Installation</h1>
<h2>External Requirements</h2>
The following external libraries are required when building libFMS<ul>
<li>NetCDF C and Fortran (77/90) headers and libraries</li>
<li>Fortran 2003 standard compiler</li>
<li>Fortran compiler that supports Cray Pointer</li>
<li>MPI C and Fortran headers and libraries (optional)</li>
<li>Linux or Unix style system</li>
</ul>
<h2>Supported Compilers</h2>
We strive to have libFMS built with as many C and Fortran compilers on as many Unix/Linux type systems as possible. However, internally, we only use libFMS compiled with the Intel compilers. Some groups have had success using libFMS when compiled with the GNU C and Fortran compilers.<h2>MPI Support</h2>
The default way to build libFMS is with MPI support. We have found that using the MPI aware compiler, or the MPI compiler wrappers (mpif90, mpicc, etc.), in general, offer the best results when building with MPI support. If you decide to not use an MPI aware compiler, you should pass the include and library locations to the build system.libFMS can be built without MPI support (sometimes called "no-comm mode"). To build libFMS without MPI support, pass to <code>configure</code> the <code>--disable-mpi</code> flag.<h2>Supported Build Systems</h2>
<h3>GNU Autoconf/Automake</h3>
In many cases, running the shell command <code>./configure &amp;&amp; make &amp;&amp; make install</code> will build and install this package. Since libFMS requires the netCDF libraries, you will likely need to tell configure where to find the C and Fortran netCDF headers and libraries via the <code>CPPFLAGS</code>, <code>FCFLAGS</code> and <code>LDFLAGS</code> variables<div class="fragment"><div class="line">&gt; ./configure CPPFLAGS=&quot;-I/path/to/netcdf/include&quot; \</div>
<div class="line">              FCFLAGS=&quot;-I/path/to/netcdff/include&quot; \</div>
<div class="line">              LDFLAGS=&quot;-L/path/to/netcdf/lib -L/path/to/netcdff/lib&quot;</div>
</div><!-- fragment -->When building from a GitHub clone, the user must run <code>autoreconf -i</code> before running the <code>./configure</code> script.The <code>./configure</code> script will guess as many compiler options as required to build libFMS. In some cases you may be required to supply additional compiler flags for your system. Additional compiler options can be passed to the build with the <code>CPPFLAGS</code>, <code>CFLAGS</code> and <code>FCFLAGS</code> variable. The <code>./configure</code> option <code>--disable-setting-flags</code> will not guess required compiler flags. Using this configure option will require the user to give all required flags.Run <code>./configure --help</code> to see other available configure options.<h3>CMake</h3>
To build using CMake, follow the instructions in <a href="https://github.com/NOAA-GFDL/FMS/blob/master/CMAKE_INSTRUCTIONS.md">CMAKE_INSTRUCTIONS.mk</a>. Currently the CMake configuration is the most restrictive build option as the compiler flags are immutable.<h3>GFDL MKMF</h3>
Make Makefile (<a href="https://github.com/NOAA-GFDL/mkmf">MKMF</a>) is the GFDL developed makefile generator application. MKMF uses a list of file, or a list of directories that contain Fortran or C file, a Make template file, and writes a Makefile with the correct dependencies to build a library or executable. To use MKMF to build libFMS, do the following.<ol type="1">
<li>Clone the MKMF repository from GitHub <code>git clone <a href="https://github.com/NOAA-GFDL/mkmf.git">https://github.com/NOAA-GFDL/mkmf.git</a></code></li>
<li>Add the <code>mkmf/bin</code> directory to your PATH <code>export PATH=/path/to/mkmf/bin:${PATH}</code> or <code>setenv PATH /path/to/mkmf/bin:${PATH}</code></li>
<li>Run the <code>list_paths</code> command, on the FMS directory <code>list_paths path/to/FMS</code> This will create a path_names file in the current directory</li>
<li>Pick a MKMF template from the <code>mkmf/templates</code> directory that most closely matches you system and compiler. Make any modifications as need</li>
<li>Run <code>mkmf</code> <div class="fragment"><div class="line">mkmf -c &quot;-Duse_netCDF -Duse_libMPI&quot; \</div>
<div class="line">      -I /path/to/netcdff/include \</div>
<div class="line">      -I /path/to/netcdf/include \</div>
<div class="line">      -t /path/to/mkmf/template. \</div>
<div class="line">      -p libfms.a \</div>
<div class="line">      path_names</div>
</div><!-- fragment --></li>
<li>Once built, place the <code>libfms.a</code>, <code>*.mod</code>, <code>include/\*</code> files in your install location.</li>
</ol>
While MKMF has been the build system used by GFDL to build all the GFDL models for some time, this build method requires the most user intervention when building libFMS on a new system. </div>

<h3><a id="md_libFMS_BUILD_SYSTEM"></a>BUILD_SYSTEM</h3><div class="textblock"><h1>Autotools Build System Documentation</h1>
This document describes the autotools-based build system for FMS.<h2>Introduction to Autotools</h2>
Autoconf, automake, and libtool and the GNU/Linux standard build tools. When building a package based on autotools, the user does something like:./configure &amp;&amp; make check installThe configure step queries the system about many things, and contructs makefiles.The make step uses the generated Makefiles to build, test, and install the software.Standard environment variables and configure options can be used to control many aspects of the build. Custom configure options can easily be added to support additional needs.<h3>Caution Concerning Generated Files</h3>
Autotools creates many generated files, which should not be edited or checked into the repository. Simply ignore them. Do not try to edit generated Makefiles, do not move or rename any of the shell scripts that autoreconf puts in place to let autotools work. These files have been added to .gitignore and should never be added to the repo.<h1>How to Build FMS</h1>
Previously, everyone built FMS by checking out code from git. However, with the new build system, only those who want to contribute to the code base need check out the code from git.<h2>As an FMS Developer</h2>
All FMS developers will need a reasobably reacent version of tools autoconf, automake, and libtool. These are available on package management systems. (Ex. yum install automake autoconf libtool).The process of building FMS from the repo is:<ol type="1">
<li>Clone repo and cd into repo directory.</li>
<li>Run autoreconf -i to build the developer build system.</li>
<li>Run ./configure to configure.</li>
<li>Run make to build.</li>
</ol>
<h2>As an FMS User</h2>
Users start with a tarball, not the git repo. They do not have to have any of the autotools installed. Thier build process is:<ol type="1">
<li>Unpack the tarball and cd into the directory.</li>
<li>Run ./configure &ndash;prefix=/my/installdir</li>
<li>Run make install</li>
</ol>
<h2>Precious Flags for configure</h2>
Some environment variables are important to the autotools build system, these are known as "precious" variables. One example is CC, which should be set to the C compiler.It's common to set some precious vars before the build. Commonly used ones include:</p><ul>
<li>CC the C compiler</li>
<li>FC the Fortran compiler</li>
<li>CPPFLAGS C (and Fortran) pre-processor flags</li>
<li>FCFLAGS Fortran compiler flags</li>
<li>LDFLAGS Linker flags</li>
</ul>
<h2>Standard Configure Options</h2>
The configure script has some standard options, including:</p><ul>
<li>&ndash;prefix allows user to specify install directory</li>
<li>&ndash;disable-shared disables building of shared library</li>
<li>&ndash;help prints message showing all options</li>
</ul>
<h2>FMS Configure Options</h2>
Currently there are not FMS specific configure options, but probably we will add some.<h2>Standard Make Targets</h2>
Some of the useful make targets include:</p><ul>
<li>make or make all - build code</li>
<li>make install - build code (as needed) and install</li>
<li>make check - build code (as needed) and run tests</li>
<li>make clean - clean back build</li>
<li>make distclean - clean configure output and build</li>
<li>make dist - create a tarball for distribution</li>
<li>make distcheck - create a tarball, unpack it, build and run tests, then then clean it. </li>
</ul>
</div>

<h3><a id="md_LICENSE"></a>LICENSE</h3><div class="textblock"><h3>GNU LESSER GENERAL PUBLIC LICENSE</h3>
Version 3, 29 June 2007Copyright (C) 2007 Free Software Foundation, Inc. <a href="https://fsf.org/">https://fsf.org/</a>Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.This version of the GNU Lesser General Public License incorporates the terms and conditions of version 3 of the GNU General Public License, supplemented by the additional permissions listed below.<h4>0. Additional Definitions.</h4>
As used herein, "this License" refers to version 3 of the GNU Lesser General Public License, and the "GNU GPL" refers to version 3 of the GNU General Public License."The Library" refers to a covered work governed by this License, other than an Application or a Combined Work as defined below.An "Application" is any work that makes use of an interface provided by the Library, but which is not otherwise based on the Library. Defining a subclass of a class defined by the Library is deemed a mode of using an interface provided by the Library.A "Combined Work" is a work produced by combining or linking an Application with the Library. The particular version of the Library with which the Combined Work was made is also called the "Linked
Version".The "Minimal Corresponding Source" for a Combined Work means the Corresponding Source for the Combined Work, excluding any source code for portions of the Combined Work that, considered in isolation, are based on the Application, and not on the Linked Version.The "Corresponding Application Code" for a Combined Work means the object code and/or source code for the Application, including any data and utility programs needed for reproducing the Combined Work from the Application, but excluding the System Libraries of the Combined Work.<h4>1. Exception to Section 3 of the GNU GPL.</h4>
You may convey a covered work under sections 3 and 4 of this License without being bound by section 3 of the GNU GPL.<h4>2. Conveying Modified Versions.</h4>
If you modify a copy of the Library, and, in your modifications, a facility refers to a function or data to be supplied by an Application that uses the facility (other than as an argument passed when the facility is invoked), then you may convey a copy of the modified version:<ul>
<li>a) under this License, provided that you make a good faith effort to ensure that, in the event an Application does not supply the function or data, the facility still operates, and performs whatever part of its purpose remains meaningful, or</li>
<li>b) under the GNU GPL, with none of the additional permissions of this License applicable to that copy.</li>
</ul>
<h4>3. Object Code Incorporating Material from Library Header Files.</h4>
The object code form of an Application may incorporate material from a header file that is part of the Library. You may convey such object code under terms of your choice, provided that, if the incorporated material is not limited to numerical parameters, data structure layouts and accessors, or small macros, inline functions and templates (ten or fewer lines in length), you do both of the following:<ul>
<li>a) Give prominent notice with each copy of the object code that the Library is used in it and that the Library and its use are covered by this License.</li>
<li>b) Accompany the object code with a copy of the GNU GPL and this license document.</li>
</ul>
<h4>4. Combined Works.</h4>
You may convey a Combined Work under terms of your choice that, taken together, effectively do not restrict modification of the portions of the Library contained in the Combined Work and reverse engineering for debugging such modifications, if you also do each of the following:<ul>
<li>a) Give prominent notice with each copy of the Combined Work that the Library is used in it and that the Library and its use are covered by this License.</li>
<li>b) Accompany the Combined Work with a copy of the GNU GPL and this license document.</li>
<li>c) For a Combined Work that displays copyright notices during execution, include the copyright notice for the Library among these notices, as well as a reference directing the user to the copies of the GNU GPL and this license document.</li>
<li>d) Do one of the following:<ul>
<li>0) Convey the Minimal Corresponding Source under the terms of this License, and the Corresponding Application Code in a form suitable for, and under terms that permit, the user to recombine or relink the Application with a modified version of the Linked Version to produce a modified Combined Work, in the manner specified by section 6 of the GNU GPL for conveying Corresponding Source.</li>
<li>1) Use a suitable shared library mechanism for linking with the Library. A suitable mechanism is one that (a) uses at run time a copy of the Library already present on the user's computer system, and (b) will operate properly with a modified version of the Library that is interface-compatible with the Linked Version.</li>
</ul>
</li>
<li>e) Provide Installation Information, but only if you would otherwise be required to provide such information under section 6 of the GNU GPL, and only to the extent that such information is necessary to install and execute a modified version of the Combined Work produced by recombining or relinking the Application with a modified version of the Linked Version. (If you use option 4d0, the Installation Information must accompany the Minimal Corresponding Source and Corresponding Application Code. If you use option 4d1, you must provide the Installation Information in the manner specified by section 6 of the GNU GPL for conveying Corresponding Source.)</li>
</ul>
<h4>5. Combined Libraries.</h4>
You may place library facilities that are a work based on the Library side by side in a single library together with other library facilities that are not Applications and are not covered by this License, and convey such a combined library under terms of your choice, if you do both of the following:<ul>
<li>a) Accompany the combined library with a copy of the same work based on the Library, uncombined with any other library facilities, conveyed under the terms of this License.</li>
<li>b) Give prominent notice with the combined library that part of it is a work based on the Library, and explaining where to find the accompanying uncombined form of the same work.</li>
</ul>
<h4>6. Revised Versions of the GNU Lesser General Public License.</h4>
The Free Software Foundation may publish revised and/or new versions of the GNU Lesser General Public License from time to time. Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns.Each version is given a distinguishing version number. If the Library as you received it specifies that a certain numbered version of the GNU Lesser General Public License "or any later version" applies to it, you have the option of following the terms and conditions either of that published version or of any later version published by the Free Software Foundation. If the Library as you received it does not specify a version number of the GNU Lesser General Public License, you may choose any version of the GNU Lesser General Public License ever published by the Free Software Foundation.If the Library as you received it specifies that a proxy can decide whether future versions of the GNU Lesser General Public License shall apply, that proxy's public statement of acceptance of any version is permanent authorization for you to choose that version for the Library. </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
