<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FMS: ChangeLog</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FMS
   &#160;<span id="projectnumber">$ver</span>
   </div>
   <div id="projectbrief">Flexible Modeling System</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_CHANGELOG.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ChangeLog </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All notable changes to this project will be documented in this file.</p>
<p>The format is based on <a href="https://keepachangelog.com/en/1.0.0">Keep a Changelog</a>, and this project uses <code>yyyy.rr[.pp]</code>, where <code>yyyy</code> is the year a patch is released, <code>rr</code> is a sequential release number (starting from <code>01</code>), and an optional two-digit sequential patch number (starting from <code>01</code>).</p>
<h1>[2021.01] - 2021-03-08</h1>
<h2>Added</h2>
<ul>
<li>MPP: A counter for timers to report how many times a timer section is run</li>
<li>MPP: Adds missing interfaces to be consistent with interfaces that use the OVERLOAD and no_8byte_integer macros in order to allow building without MPI</li>
<li>MPP: Extends interfaces for read and write routines to include 32-bit and 64-bit real data arrays</li>
<li>MPP: Adds unit tests for mpp and mpp_io for all public routines with mixed-precision interfaces and expands on existing tests for mixed-precision</li>
<li>Adds an .editorconfig file with the project's preferred editor configuration</li>
<li>A variable MODDIR in configure.ac for use in Makefiles to find required Fortran module files</li>
<li>Adds FMS description web page as a markdown file <h2>Changed</h2>
</li>
</ul>
<ul>
<li>DOCS: Updates various modules to doxygen style comments and makes adjustments to correctly generate doxygen documentation through the build system</li>
<li>PLATFORM: changes usage of platform.h to platform_mod and it's associated data types</li>
<li>Changes all previous uses of flush subroutine calls to function calls</li>
<li>Changes travis CI to Github actions CI and removed all trailing whitespace <h2>Removed</h2>
</li>
</ul>
<h2>Fixed</h2>
<ul>
<li>MPP: Fixed a bug causing mpp_get_UG_domain_tile_pe_inf to seg fault from the incorrect assignment of an optional argument</li>
<li>FMS: Fixes issues with FMS unit tests failing from pointer allocations by reworking deallocate_unstruct_pass_type</li>
<li>MPP_IO: Fixes unintentional printing of file attributes</li>
<li>An issue with the automake build system causing unnecessary rebuilds of source files</li>
<li>Fixes CMake build of the FMS library to install configuration files in the appropriate directories; and for OpenMP dependencies to the private <h2>Tag Commit Hashes</h2>
</li>
</ul>
<ul>
<li>2021.01-alpha1 (dbe8a1060fb33167c2d12239484226b40fb01fd0)</li>
<li>2021.01-alpha2 (b94eb18fe8e686c5958cbbacc4cf9130873afc85)</li>
<li>2021.01-beta1 (4dcc9a795d9ba0cc959ebd93dda5be5f8473545c)</li>
</ul>
<h1>[2020.04] - 2020-12-07</h1>
<h2>Added</h2>
<ul>
<li>DIAG_MANAGER: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>DIAG_MANAGER: A check is added before a time axis is registered to check if the time axis is registered as a variable</li>
<li>DIAG_MANAGER: A unit test was added to test the optional <code>new_file_freq</code> functionality</li>
<li>XGRID: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>INTERPOLATOR: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>AMIP_INTERP: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>TOPOGRAPHY: A namelist flag called <code>use_mpp_io</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>DATA_OVERRIDE: A namelist flag called <code>use_mpp_bug</code> if set to .true. will use mpp_io. The default is .false. and will use fms2_io.</li>
<li>DATA_OVERRIDE: A namelist flag called <code>reproduce_null_char_bug_flag</code> if set to .true. and fms2_io is being used, it will reproduce the mpp_io bug where the axis bounds were calculated instead of read. The default is .false. A unit test was added to test the functionality of <code>get_grid_version_1</code></li>
<li>FMS2_IO: A unit test was added to test the functionality of <code>get_valid</code> and <code>is_valid</code> <h2>Changed</h2>
</li>
</ul>
<ul>
<li>The autotools build has been changed to copy each subdirectory module (.mod) files to a common .mod directory located at the top of the source directory. This change simplifies the include path specifications.</li>
<li>Use F90 module files for external libraries (MPI and NetCDF) for improved interface checking, thereby removing the reliance on library header include files.</li>
<li>FMS2_IO: Changed how nest file names are created to be consistent with mpp_io</li>
<li>CMAKE: Changed visibility of FMS OpenMP libraries to private in order to avoid conflicts with model libraries <h2>Removed</h2>
</li>
</ul>
<ul>
<li>LIBFMS: The flag -Duse_mpp_io should not be used and will cause a crash</li>
<li>LIBFMS: Macros and logic for interfacing to the Flexible File I/O library</li>
<li>LIBFMS: Macros for SGI MIPSpro compilers, including: mpp_node function and SGI Irix specific high resolution timer</li>
<li>LIBFMS: Macros for IBM AIX compilers</li>
<li>LIBFMS: Files in mpp supporting the CRAY SHMEM communications library</li>
<li>LIBFMS: Files in mpp for the SGI PSET approach for communication via GSM</li>
<li>MPP_IO: removed left over #ifdefs from backwards compatibility changes <h2>Fixed</h2>
</li>
</ul>
<ul>
<li>DATA_OVERRIDE: Fixed a bug in <code>get_grid_version_1</code> where the variable_size calls were not correct</li>
<li>FMS2_IO: Fixed a bug in <code>get_valid</code> where the mpp_broadcast calls were done inside <code>if (root_pe)</code> blocks The fms2_io unit tests were modified so they can work with the AOCC compiler</li>
<li>XGRID: Fixed a bug in <code>load_xgrid</code> by checking if a dimension exists before calling <code>get_dimension_size</code> to avoid <code>FATAL: NetCDF: Invalid dimension ID or name</code> crashes</li>
<li>DIAG_MANAGER: Fixed a bug where files were getting written with redundant time_bounds data</li>
<li>CMAKE: Fixed a bug causing the build to fail on latest versions of Ubuntu</li>
<li>CMAKE: Fixed a bug that caused the build to fail from incorrect source paths <h2>Tag Commit Hashes</h2>
</li>
</ul>
<ul>
<li>2020.04-alpha1 (2428bb182133b8062432ee1b15974739753ca470)</li>
<li>2020.04-alpha2 (ad9915d83a2f34610cd748fd85889ba1f0f1fc02)</li>
<li>2020.04-alpha3 (e7e48839ab25cc9405abe5d8418e1b6ee6fb2d69)</li>
<li>2020.04-beta1 (6d3ac620423e7ede412e4bb1b36c338775d95193)</li>
</ul>
<h1>[2020.03] - 2020-10-08</h1>
<h2>Added</h2>
<ul>
<li>FMS2_IO: Adds header_buffer_val to the fms2io namelist which sets the netcdf header size in bytes. The default value is 16kb</li>
<li>FMS2_IO: Adds netcdf_default_format to the fms2io namelist which allows the user to change the netcdf file type. The default value is 64bit.</li>
<li>FMS2_IO: Adds support to read netcdf string global attributes</li>
<li>FMS2_IO: Adds an optional argument to open_file, <code>dont_add_res_to_filename</code>, which indicates that the filename should not be modified (default adds .res to restart file name)</li>
<li>FMS2_IO: Modifies the <code>register_variable_attribute</code> and <code>register_global_attribute</code> interfaces by adding str_len as an argument. This is a workaround to get fms2io to work with PGI because they don't support class (*) with len=*.</li>
<li>FMS2_IO: Adds unit test that tests <code>write_data</code> and <code>read_data</code> when using a domain with a mask table</li>
<li>FMS2_IO: Adds fms2io’s version of get_mosaic_tile_grid</li>
<li>MPP_IO: Adds <code>-Duse_mpp_io</code> compile option for data_override, interpolator, amip_interp, diag_manager, topography, and xgrid to select using mpp_io instead of fms2_io</li>
<li>MPP_INIT: Adds unit tests for routines/functions that are called in mpp_init</li>
<li>CMAKE: A cmake build system has been added with a CI build using cmake <h2>Changed</h2>
</li>
</ul>
<ul>
<li>FMS2_IO: Improves performance of previous release by gathering the domain decomposed data into one global buffer and doing one write rather than doing multiple reads</li>
<li>DATA_OVERRIDE: Changes line in time_interp_external2 to enable 3D overrides</li>
</ul>
<h2>Fixed</h2>
<ul>
<li>DATA_OVERRIDE[2]: Fixes a crash when doing ongrid data_override calls with a domain with halos</li>
<li>DIAG_MANAGER[2]: Fixes an issue where time_bnds were written incorrectly for the last time stamp</li>
<li>DIAG_MANAGER: Regional diagnostics with a mask table now work</li>
<li>FMS2_IO: Unit test includes fms2io_init call to improve functionality</li>
<li>MPP: BOZ literals that are used in variable declaration are converted to integers using the int() function.</li>
<li>MPP_DOMAINS2: Fixed unit test</li>
<li>FMS_IO: Changes the logic in get_tile_string to fix bug where tile numbers 9 and 99 produce an inappropriate error</li>
</ul>
<h2>Tag Commit Hashes</h2>
<ul>
<li>2020.03-beta4 (4d38679c1e18e920feb03d69f8a9762eb6a047aa)</li>
<li>2020.03-beta3 (521a15135a99d1f2da7d82f238353945f82ce1dd)</li>
<li>2020.03-beta2 (3dae0dfa405d555ecc09bbd2d60a1be24461f69e)</li>
<li>2020.03-beta1 (f7f1c1c73c1f478a53e84caee6aff2fa840ad086)</li>
<li>2020.03-alpha1 (2dd30b7ca0ac75a4a38b969e4a6d446eb395b4dd)</li>
</ul>
<h1>[2020.02] - 2020-05-01</h1>
<h2>Added</h2>
<ul>
<li>FMS2_IO: An fms2_io_nml namelist has been created. It includes the variable ncchksz. This is the replacement for the environment variable NC_BLKSZ set in model run scripts and used by mpp_io. The default value is 64 KB. Any time a file is opened in fms2_io (nf90_open or nf90_create), the optional argument <code>chunksize=ncchksz</code> is passed to the NetCDF library. NetCDF attempts to use this value to control the blocksize utilized for reads and writes of data from the filesystem.</li>
<li>FMS2_IO: Adds support to <code>compute_global_cheksum.inc</code> for <code>real32</code>, assuming the flag <code>-DOVERLOAD_R4</code> is used when compiling.</li>
</ul>
<h2>Changed</h2>
<ul>
<li>MPP_DOMAINS - nesting: The logic supporting nested domains for mosaic grids has been overhauled and extended. FMS now supports multiple nests and telescoping nests (nest embedded within a nest). The requirement for a nest to lie wholly within a single tile has been relaxed and a first-level nest may cross tile boundaries, but may not contain a tile corner. Communications for two-way nesting have also been improved. The 2019 December Public Release and 2020.02 GFDL Release within the <a href="https://github.com/NOAA-GFDL/GFDL_atmos_cubed_sphere">GFDL_atmos_cubed_sphere</a> have been updated and are compatible with this release of FMS.</li>
<li>FMS2_IO: The intent of fileobj is changed from (in) to (inout) in netcdf_restore_state_wrap, restore_domain_state, and netcdf_restore_state because the file object type has a pointer that is being reassigned in one of the routines lower in the call stack.</li>
</ul>
<h2>Deprecated</h2>
<ul>
<li>MPP_DOMAINS - nesting: The initial nesting implementation is no longer supported. Please see the Changed::MPP_DOMAINS sub-entry under.</li>
</ul>
<h2>Removed</h2>
<ul>
<li>GENERAL: References to the macro _ALLOCATABLE have been replaced with “allocatable”, _ALLOCATED has been replaced with “allocated”, and _NULL has been removed. It is now assumed that all compilers support the Fortran 2003 standard. The macros still exist in fms_platforms.h for compatibility within other components.</li>
<li>DIAG_MANAGER: “fms_platform.h” is no longer included in any of the diag_manager routines. Instead, fms_platform_mod is now being use-associated where necessary. This fixes an issue for debuggers not providing correct line numbers.</li>
</ul>
<h2>Tag Commit Hashes</h2>
<ul>
<li>2020.02-beta1 (bbc6f8d33cfb75a411bbcd3f8423fa74b8b7cdfd)</li>
<li>2020.02-beta2 (6242941a632f6e261234f3a575e59efa1bfb1b36)</li>
<li>2020.02-beta3 (e6fd03b070eb1ba8ffbca740fd69681ee16d6be7)</li>
</ul>
<h1>[2020.01] - 2020-03-13</h1>
<h2>Added</h2>
<ul>
<li>Adds the modules <code>axis_utils2</code>, <code>mosaic2</code>, and <code>time_interp_external2</code> that use <code>fms2_io</code></li>
<li>Adds unit tests for thread affinity in test_fms/affinity</li>
<li>Autotools unit tests are now run with <code>srun, mpirun</code>, or <code>aprun</code> (whichever is present on your system)</li>
<li><code>fms2_io</code> provides three new derived types, which target the different I/O paradigms used in GFDL GCMs:<ul>
<li>type(FmsNetcdfFile_t) - This type provides a thin wrapper over the netCDF4 library, but allows the user to assign a “pelist” to the file. If a pelist is assigned, only the first rank on the list directly interacts with the netCDF library, and performs broadcasts to relay the information to the rest of the ranks on the list. This derived type also allows the user to perform “compressed” reads/writes and restart variable “registration” (i.e. the ability to store pointers to user-defined/allocated buffers) and reads/writes in a manner similar to the existing calls in fms_io.</li>
<li>type(FmsNetcdfUnstructuredDomainFile_t) - This type extends the FmsNetcdfFile_t type to support “domain-decomposed” reads/writes on a user defined mpp_domains unstructured grid. Users are required to inform the FMS2_io module which dimensions correspond to the unstructured grid using the appropriate <code>register_axis</code> call before any domain-decomposed reads/writes can be performed.</li>
<li>type(FmsNetcdfDomainFile_t) - This type extends the FmsNetcdfFile_t type to support “domain-decomposed” reads/writes on a user-defined <code>mpp_domains</code> two-dimensional lon-lat or cubed-sphere grid. Users are required to inform the <code>fms2_io</code> module which dimensions (‘x’ or ‘y’) correspond to the two-dimensional grid using the appropriate <code>register_axis</code> calls before any domain-decomposed reads/writes can be performed.</li>
</ul>
</li>
<li><code>fms2_io</code> requires the user to manage objects of the types described above. Calls to <code>open_file</code> (<code>close_file</code>) act as constructors (destructors) for each of the objects, and must be explicitly made by the user. Each object must be constructed before any I/O can be performed. Examples describing how to use these new types are available in <a href="https://github.com/NOAA-GFDL/FMS/tree/master/test_fms/fms2_io">test_fms/fms2_io</a></li>
<li><code>fms2_io</code> treats *_FillValue* attributes as <em>valid_max</em> or <em>valid_min</em> range specifiers if none of <em>valid_range</em>, <em>valid_min</em>, and <em>valid_max</em> are specified as described in these <a href="https://www.unidata.ucar.edu/software/netcdf/docs/attribute_conventions.html">netcdf conventions</a></li>
</ul>
<h2>Changed</h2>
<ul>
<li>The <code>diag_manager</code> IO is handled by fms2_io instead of mpp_io. Default behavior assumes that the mpp_io namelist variable is set to <em>cf_compliant = .true.</em></li>
<li>The user must specify the diagnostic attributes that they want to write to the output files. Example: If there is no <em>units</em> attribute, then the variable metadata will not include <em>units</em>, and it will not automatically add <em>units = “none”</em>.</li>
<li>Calls to <code>register_diag_axis</code> for an X or Y axis that is shifted from the <em>CENTER</em> position need to include the optional argument <em>domain_position</em> and should be equal to <em>EAST</em> or <em>NORTH</em> based on the position relative to the domain. EAST and <em>NORTH</em> are exposed through <code>diag_manager_mod</code>.</li>
<li>Changed the handling of <em>average_T</em> and <em>time_bnds</em> variables so that they are set to values that are sent in and are not manipulated as was the case in mpp_io.</li>
<li><code>interpolator</code>, <code>xgrid</code>, <code>data_override</code>, and <code>amip_interp</code> now call <code>fms2_io</code> routines</li>
<li>Support for enabling/disabling quad-precision (used in certain calculations) has been changed to a hard on/off switch. Default behavior is quad-precision disabled. To enable, add the following CPP macro -DENABLE_QUAD_PRECISION. This change was necessary to remove guessing at the proper setting via a mix of compiler vendor and system-defined environment variables which resulted in different behaviors on machines unbeknownst to the user.</li>
</ul>
<h2>Deprecated</h2>
<ul>
<li>fms2_io does <b>NOT</b> use the <em>scale_factor</em>, <em>add_offset</em>, or other attributes to manipulate the data. The variable/data is returned to the caller as it appears in the file. All post-read data manipulations should be handled by the caller. <h2>Removed</h2>
</li>
</ul>
<ul>
<li>Removes the use of bats when running unit tests</li>
</ul>
<h2>Tag Commit Hashes</h2>
<ul>
<li>2020.01-alpha1 (09dc8e9e0f1c852e9e9190834176d16943cd3729)</li>
<li>2020.01-beta1 (e1c0d9d01d844938adc0d18afa09532f336bcdfe)</li>
<li>2020.01-beta2 (b68de5382a5ce631ddd6167de8d85f7c9ae54351)</li>
</ul>
<h1>[2019.01] - 2019-11-26</h1>
<h2>Added</h2>
<ul>
<li>switch from "city" versioning style to <code>yyyy.&lt;2_digit_version_number&gt;[.&lt;2-digit-patch number&gt;]</code> style</li>
<li>main development branch is <code>master</code> instead of <code>dev/master</code></li>
<li>affinity handling moved to the affinity directory</li>
<li>support for building with autotools</li>
<li><a href="include/fms_platform.h">fms_platform.h</a> contains directives that support building on macOS</li>
<li>unit and build tests are available in the [test_fms](test_fms) directory</li>
<li>updated <a href="fv3gfs/makefile">fv3gfs/makefile</a> for use with current EMC build system <h2>Fixed</h2>
</li>
</ul>
<ul>
<li>Fixed <code>time_interp_missing</code> parameter in <a href="time_interp/time_interp_external.F90">time_interp/time_interp_external.F90</a> to be within range when compiled in mixed-mode.</li>
<li>reverted <code>QUAD_PRECISION</code> cpp macro behavior to pre-Xanadu behavior in <a href="include/fms_platform.h">include/fms_platform.h</a></li>
<li>Fixed a GNU compiler issue with the logical check to set the netCDF fill value in <code>mpp_io_write</code> by separating the logical <code>.AND.</code> into nested <code>if</code> statements. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
